<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beach Volley</title>
<meta name="theme-color" content="#fdd835">
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0; padding: 0;
  background: #fff8e1;
}
h1 {
  text-align: center;
  background: #fdd835;
  padding: 10px;
  margin: 0;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin: 10px 0;
}
th, td {
  border: 1px solid #999;
  padding: 6px;
  text-align: center;
}
input {
  width: 50px;
}
.section {
  padding: 10px;
}
button {
  padding: 8px 12px;
  margin-top: 5px;
  background: #fdd835;
  border: none;
  cursor: pointer;
}
button:hover {
  background: #fbc02d;
}
</style>
</head>
<body>
<h1>üèê Beach Volley</h1>
<div class="section">
<h2>Setup Players</h2>
<table id="setupTable">
<tr><th>Player Name</th></tr>
<tr><td><input></td></tr>
<tr><td><input></td></tr>
<tr><td><input></td></tr>
<tr><td><input></td></tr>
<tr><td><input></td></tr>
</table>
<button onclick="generateMatches()">Generate Matches</button>
</div>
<div class="section">
<h2>Matches</h2>
<table id="matchesTable">
<tr><th>Match</th><th>Team 1</th><th>Team 2</th><th>Winner</th><th>Pts Team 1</th><th>Pts Team 2</th></tr>
</table>
<button onclick="updateStats()">Update Stats</button>
</div>
<div class="section">
<h2>Player Stats</h2>
<table id="statsTable">
<tr><th>Player</th><th>Wins</th><th>Losses</th><th>Points Scored</th><th>Points Conceded</th><th>Total Points</th></tr>
</table>
</div>
<script>
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function generateMatches() {
  const names = Array.from(document.querySelectorAll('#setupTable input'))
    .map(i => i.value.trim())
    .filter(n => n);
  if (names.length < 4) {
    alert('Enter at least 4 players');
    return;
  }
  const matches = [];
  while (matches.length < 10) {
    let players = shuffle([...names]);
    players.pop(); // rest player
    let t1 = [players.pop(), players.pop()];
    let t2 = [players.pop(), players.pop()];
    matches.push([t1, t2]);
  }
  const table = document.getElementById('matchesTable');
  table.innerHTML = '<tr><th>Match</th><th>Team 1</th><th>Team 2</th><th>Winner</th><th>Pts Team 1</th><th>Pts Team 2</th></tr>';
  matches.forEach((m, idx) => {
    let row = table.insertRow();
    row.insertCell().textContent = idx+1;
    row.insertCell().textContent = m[0].join(' & ');
    row.insertCell().textContent = m[1].join(' & ');
    let winCell = row.insertCell();
    let sel = document.createElement('select');
    sel.innerHTML = '<option value=""></option><option value="1">1</option><option value="2">2</option>';
    winCell.appendChild(sel);
    row.insertCell().innerHTML = '<input type="number" min="0">';
    row.insertCell().innerHTML = '<input type="number" min="0">';
  });
  const stats = document.getElementById('statsTable');
  stats.innerHTML = '<tr><th>Player</th><th>Wins</th><th>Losses</th><th>Points Scored</th><th>Points Conceded</th><th>Total Points</th></tr>';
  names.forEach(n => {
    let r = stats.insertRow();
    r.insertCell().textContent = n;
    for (let i=0;i<5;i++) r.insertCell().textContent = 0;
  });
}

function updateStats() {
  const stats = {};
  Array.from(document.querySelectorAll('#statsTable tr')).slice(1).forEach(r => {
    let name = r.cells[0].textContent;
    stats[name] = {wins:0, losses:0, ps:0, pc:0};
  });
  Array.from(document.querySelectorAll('#matchesTable tr')).slice(1).forEach(r => {
    const team1 = r.cells[1].textContent.split(' & ');
    const team2 = r.cells[2].textContent.split(' & ');
    const winner = r.cells[3].querySelector('select').value;
    const pts1 = parseInt(r.cells[4].querySelector('input').value) || 0;
    const pts2 = parseInt(r.cells[5].querySelector('input').value) || 0;
    team1.forEach(p => {stats[p].ps += pts1; stats[p].pc += pts2;});
    team2.forEach(p => {stats[p].ps += pts2; stats[p].pc += pts1;});
    if (winner === "1") {
      team1.forEach(p => stats[p].wins++);
      team2.forEach(p => stats[p].losses++);
    } else if (winner === "2") {
      team2.forEach(p => stats[p].wins++);
      team1.forEach(p => stats[p].losses++);
    }
  });
  Array.from(document.querySelectorAll('#statsTable tr')).slice(1).forEach(r => {
    let name = r.cells[0].textContent;
    r.cells[1].textContent = stats[name].wins;
    r.cells[2].textContent = stats[name].losses;
    r.cells[3].textContent = stats[name].ps;
    r.cells[4].textContent = stats[name].pc;
    r.cells[5].textContent = stats[name].ps - stats[name].pc;
  });
}

if ('serviceWorker' in navigator) {
  const swCode = `self.addEventListener('install', e => {
    e.waitUntil(caches.open('beach-volley').then(cache => cache.addAll(['./'])));
    self.skipWaiting();
  });
  self.addEventListener('fetch', e => {
    e.respondWith(caches.match(e.request).then(resp => resp || fetch(e.request)));
  });`;
  const blob = new Blob([swCode], {type: 'application/javascript'});
  const swURL = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swURL);
}
</script>
</body>
</html>
